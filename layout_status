#!/bin/bash
# –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã

echo "=== –°—Ç–∞—Ç—É—Å –±–µ—Å—à–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å–∫–ª–∞–¥–æ–∫ ==="
echo

echo "1. –¢–µ–∫—É—â–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞:"
CURRENT_LAYOUT=$HOME/.local/bin/layout_check
echo "   $CURRENT_LAYOUT"

echo
echo "2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GSettings:"
echo "   –ò—Å—Ç–æ—á–Ω–∏–∫–∏: $(gsettings get org.gnome.desktop.input-sources sources)"
echo "   –û–ø—Ü–∏–∏ XKB: $(gsettings get org.gnome.desktop.input-sources xkb-options)"
echo "   MRU –∏—Å—Ç–æ—á–Ω–∏–∫–∏: $(gsettings get org.gnome.desktop.input-sources mru-sources)"

echo
echo "3. –°—Ç–∞—Ç—É—Å –±–µ—Å—à–æ–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∞:"
if pgrep -f "layout_final_monitor" > /dev/null; then
    echo "   ‚úÖ –ë–µ—Å—à–æ–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω (PID: $(pgrep -f layout_final_monitor))"
    if [ -f /tmp/layout_final_monitor.log ]; then
        echo "   –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏:"
        tail -3 /tmp/layout_final_monitor.log | sed 's/^/     /'
    fi
else
    echo "   ‚ùå –ë–µ—Å—à–æ–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
fi

echo
echo "4. –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞:"
if [ -f /home/maendeleo/.config/autostart/layout-monitor.desktop ]; then
    echo "   ‚úÖ .desktop —Ñ–∞–π–ª –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–µ"
else
    echo "   ‚ùå .desktop —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
fi

echo
echo "5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:"
echo "   –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥–∫—É (Alt+Shift) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "   - –ü–∞–Ω–µ–ª—å –ù–ï –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–∞—Ç—å/–ø–æ—è–≤–ª—è—Ç—å—Å—è"
echo "   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –±–µ—Å—à–æ–≤–Ω–æ"

echo
echo "6. –õ–æ–≥–∏:"
if [ -f /tmp/layout_final_monitor.log ]; then
    echo "   ‚úÖ –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã: tail -f /tmp/layout_final_monitor.log"
else
    echo "   ‚ùå –õ–æ–≥–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç"
fi

echo
echo "7. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
if pgrep -f "layout_final_monitor" > /dev/null; then
    echo "   ‚úÖ –ë–µ—Å—à–æ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ"
    echo "   üí° –ü–∞–Ω–µ–ª—å –¥–æ–ª–∂–Ω–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞"
else
    echo "   ‚ö†Ô∏è  –ó–∞–ø—É—Å—Ç–∏—Ç–µ: /home/maendeleo/.local/bin/autostart_layout_monitor"
fi